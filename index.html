<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>Firebase 記帳測試</title>
</head>
<body>
  <h2>記帳測試</h2>
  <form id="form">
    <select id="type">
      <option value="income">收入</option>
      <option value="expense">支出</option>
    </select>
    <input id="amount" type="number" placeholder="金額" required />
    <input id="note" type="text" placeholder="備註" />
    <input id="date" type="date" required />
    <button type="submit">新增</button>
  </form>

  <h3>目前資料</h3>
  <ul id="output"></ul>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDEOsfYrAGpAnYsiYyBpaYCC-EFL9dnL6k",
      authDomain: "project-1743045136631756226.firebaseapp.com",
      projectId: "project-1743045136631756226",
      storageBucket: "project-1743045136631756226.appspot.com",
      messagingSenderId: "660576126542",
      appId: "1:660576126542:web:ff0f574ec65385b7fa251f",
      measurementId: "G-31VC1RK1HK"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const colRef = collection(db, "records");

    const form = document.getElementById("form");
    const output = document.getElementById("output");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const type = document.getElementById("type").value;
      const amount = parseFloat(document.getElementById("amount").value);
      const note = document.getElementById("note").value;
      const date = document.getElementById("date").value;

      try {
        await addDoc(colRef, { type, amount, note, date });
        alert("成功寫入！");
        form.reset();
        loadData();  // 重新載入資料
      } catch (err) {
        alert("寫入失敗：" + err.message);
        console.error(err);
      }
    });

    async function loadData() {
      output.innerHTML = "";
      const snapshot = await getDocs(colRef);
      snapshot.forEach(doc => {
        const data = doc.data();
        const li = document.createElement("li");
        li.textContent = `[${data.date}] ${data.type}: ${data.amount} 元，備註：${data.note}`;
        output.appendChild(li);
      });
    }

    loadData();
  </script>
</body>
</html>
